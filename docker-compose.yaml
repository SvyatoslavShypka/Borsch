version: "3.9"

services:
  web:
    secrets:
      - NOTE_DB_U
      - NOTE_DB_P
    expose:
      - 2665
    ports:
      - 7778:7778
    image: borsch3:latest
#    entrypoint: "/bin/sh -c 'eureka_password=`cat /run/secrets/password` && echo $eureka_password'"
    entrypoint: "/bin/sh -c 'export NOTE_DB_USER=`cat /run/secrets/NOTE_DB_U`'"
#    entrypoint: "/bin/sh -c 'export NOTE_DB_PASSWORD=`cat /run/secrets/NOTE_DB_P`'"
#    entrypoint: "/bin/sh -c 'set NOTE_DB_PASSWORD=`cat /run/secrets/NOTE_DB_P` && set NOTE_DB_USER=`cat /run/secrets/NOTE_DB_U`'"
#    entrypoint: "/bin/sh -c 'cat /run/secrets/NOTE_DB_P'"
    environment:
#      - NOTE_DB_USER=user5
      - NOTE_DB_USER=${NOTE_DB_US}
#      - NOTE_DB_PASSWORD=${NOTE_DB_PA}
      - spring.profiles.active=production
#    restart: always
    build: .
secrets: # top level secrets block
  NOTE_DB_U:
    file: /NOTE_DB_USER.txt
  NOTE_DB_P:
    file: /NOTE_DB_PASSWORD.txt
